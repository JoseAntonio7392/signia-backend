<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprende Lengua de Señas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3.1640029074/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.3.1620248257/drawing_utils.js" crossorigin="anonymous"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #1a202c, #2d3748);
            color: white;
            overflow-x: hidden;
        }
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: #2d3748;
            padding: 2rem;
            border-radius: 0.5rem;
            text-align: center;
            max-width: 500px;
            width: 90%;
        }
        .modal-content img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 1rem;
        }
        .modal-content input[type="text"] {
            width: 100%;
            padding: 0.5rem;
            margin-bottom: 1rem;
            border-radius: 0.25rem;
            border: 1px solid #4a5568;
            background: #1a202c;
            color: white;
        }
        .modal-content input[type="file"] {
            margin-bottom: 1rem;
        }
        .video-container {
            position: relative;
            max-width: 640px;
            width: 100%;
            margin: 0 auto;
        }
        .video-container.hands-detected video {
            filter: brightness(1);
        }
        video, canvas {
            width: 100%;
            height: auto;
            border-radius: 0.5rem;
        }
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }
        .status-text {
            font-size: 1.25rem;
            font-weight: 500;
        }
        .blink {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        .error-message {
            color: #f56565;
            font-weight: bold;
        }
        .debug-text {
            font-size: 0.875rem;
            color: #a0aec0;
            white-space: pre-wrap;
        }
        .option-button {
            background: linear-gradient(to right, #a855f7, #ec4899);
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-weight: bold;
            transition: transform 0.3s;
        }
        .option-button:hover {
            transform: scale(1.05);
        }
        .card {
            background: #2d3748;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .category-button {
            background: #4a5568;
            padding: 0.75rem;
            font-size: 1.1rem;
        }
        .carousel-container {
            position: relative;
            max-width: 100%;
            overflow: hidden;
        }
        .carousel {
            display: flex;
            transition: transform 0.5s ease;
        }
        .carousel-item {
            flex: 0 0 100%;
            text-align: center;
        }
        .carousel-item img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
        }
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            cursor: pointer;
        }
        .carousel-nav.prev { left: 10px; }
        .carousel-nav.next { right: 10px; }
        .back-button {
            background: #4a5568;
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            font-weight: bold;
        }
        .user-button {
            background: linear-gradient(to right, #4c51bf, #667eea);
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            font-weight: bold;
        }
        .combobox {
            background: #1a202c;
            color: white;
            padding: 0.5rem;
            border-radius: 0.25rem;
            border: 1px solid #4a5568;
        }
        .header-logo {
            filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
        }
        .animate-fade-in {
            animation: fadeIn 1s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <canvas id="starfield"></canvas>
    <div id="app"></div>
    <script>
        console.log('[DEBUG] Script started at ' + new Date().toLocaleString('en-US', { timeZone: 'America/Chicago' }));

        // Starfield and Moon animation
        const starfield = document.getElementById('starfield');
        const ctxStarfield = starfield.getContext('2d');
        let stars = [];
        let moon = { x: 100, y: 100, radius: 30, phase: 0, glow: 0 };

        function initStars() {
            starfield.width = window.innerWidth;
            starfield.height = window.innerHeight;
            stars = [];
            for (let i = 0; i < 100; i++) {
                stars.push({
                    x: Math.random() * starfield.width,
                    y: Math.random() * starfield.height,
                    radius: Math.random() * 2,
                    speed: Math.random() * 0.5 + 0.1
                });
            }
            moon.x = starfield.width * 0.2;
            moon.y = starfield.height * 0.2;
        }

        function animateStarsAndMoon() {
            ctxStarfield.clearRect(0, 0, starfield.width, starfield.height);
            ctxStarfield.fillStyle = 'white';
            stars.forEach(star => {
                ctxStarfield.beginPath();
                ctxStarfield.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
                ctxStarfield.fill();
                star.y += star.speed;
                if (star.y > starfield.height) star.y = 0;
            });
            moon.phase += 0.01;
            moon.glow = 0.5 + Math.sin(moon.phase) * 0.2;
            ctxStarfield.beginPath();
            const gradient = ctxStarfield.createRadialGradient(
                moon.x, moon.y, moon.radius * 0.5,
                moon.x, moon.y, moon.radius * (1 + moon.glow)
            );
            gradient.addColorStop(0, 'rgba(255, 255, 255, 0.9)');
            gradient.addColorStop(0.7, 'rgba(255, 255, 255, 0.4)');
            gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');
            ctxStarfield.fillStyle = gradient;
            ctxStarfield.arc(moon.x, moon.y, moon.radius, 0, Math.PI * 2);
            ctxStarfield.fill();
            ctxStarfield.fillStyle = 'rgba(200, 200, 200, 0.5)';
            ctxStarfield.beginPath();
            ctxStarfield.arc(moon.x - 10, moon.y - 5, 5, 0, Math.PI * 2);
            ctxStarfield.arc(moon.x + 8, moon.y + 5, 3, 0, Math.PI * 2);
            ctxStarfield.fill();
            moon.x += Math.sin(moon.phase * 0.5) * 0.2;
            moon.y += Math.cos(moon.phase * 0.5) * 0.1;
            requestAnimationFrame(animateStarsAndMoon);
        }

        window.addEventListener('resize', () => {
            initStars();
        });
        initStars();
        animateStarsAndMoon();

        const app = document.getElementById('app');
        let cameraInstance = null;
        let landmarkHistory = [];
        const HISTORY_SIZE = 15;
        let smoothedLandmarks = [];
        let currentVideo = null;
        let lastDetectedSign = null;
        let selectedVoice = null;
        let handsInstance = null;
        let lastFrameTime = 0;
        const TARGET_FPS = 60;
        const FRAME_INTERVAL = 1000 / TARGET_FPS;
        const INAPPROPRIATE_SIGNS = [
            'Grosería (Tonto)', 'Grosería (Güey)', 'Grosería (Idiota)', 'Grosería (Puto)',
            'Grosería (Mierda)', 'Grosería (Zorra)', 'Grosería (Pendejo)', 'Grosería (Verga)'
        ];
        let sePuedeDetectar = true;
        let ultimaSeña = null;
        let detectionHistory = [];
        const DETECTION_HISTORY_SIZE = 5;

        const SIGN_DEFINITIONS = [
            // Abecedario
            'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M',
            'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z',
            // Casa
            'almohada', 'azotea', 'azúcarera', 'baño', 'barrer', 'batidora', 'bote', 'buzón',
            'cacerola', 'cajón', 'cama', 'candelero', 'casa', 'cazuela', 'cepillo de dientes',
            'cepillo de pelo', 'champú', 'charola', 'chupón', 'cobertor', 'coladera', 'colcha',
            'colador', 'comal', 'comedor', 'cómoda', 'condominio', 'copa', 'corredor', 'corriente',
            'cortina', 'cuarto', 'cuchara', 'cuchillo', 'departamento', 'destapador',
            // Escuela
            'antropología', 'bandera', 'calificación', 'campana', 'certificado', 'compás',
            'computación', 'cuaderno', 'dibujo', 'diccionario', 'escala', 'escuadra', 'escuela',
            'estudiante', 'goma', 'lápiz', 'lección', 'mapa', 'microscopio', 'papel', 'párrafo',
            'perspectiva', 'pizarrón', 'pluma', 'politécnico', 'premio', 'preparatoria', 'primaria',
            'prueba', 'química', 'sacapuntas', 'secundaria', 'tecnológico',
            // Meses
            'enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto',
            'septiembre', 'octubre', 'noviembre', 'diciembre',
            // Colores
            'naranja', 'rojo', 'verde', 'rosa', 'blanco', 'negro', 'café',
            // Estaciones
            'primavera', 'verano', 'otoño', 'invierno',
            // Días de la semana
            'lunes', 'martes', 'miércoles', 'jueves', 'viernes', 'sábado', 'domingo',
            // Animales
            'vaca', 'lobo', 'jirafa', 'tiburón', 'perro', 'gato', 'puerco', 'rinoceronte',
            'serpiente', 'tigre', 'toro', 'libélula', 'lagarto', 'gorila', 'foca',
            // Groserías
            'Grosería (Tonto)', 'Grosería (Güey)', 'Grosería (Idiota)', 'Grosería (Puto)',
            'Grosería (Mierda)', 'Grosería (Zorra)', 'Grosería (Pendejo)', 'Grosería (Verga)',
            // Saludos y otras palabras
            'saludo_hola', 'saludo_adios', 'saludo_como_estas', 'saludo_comparte', 'saludo_ayuda'
        ];

        function normalizeLandmarks(landmarks) {
            if (!landmarks || landmarks.length !== 21) {
                console.log('[DEBUG] Invalid landmarks array length:', landmarks ? landmarks.length : 'null');
                return Array(21).fill({ x: 0, y: 0, z: 0 });
            }
            return landmarks.map(lm => ({
                x: lm.x * 2 - 1,
                y: lm.y * 2 - 1,
                z: lm.z * 2 - 1
            }));
        }

        function smoothLandmarks(landmarks) {
            if (smoothedLandmarks.length === 0) {
                smoothedLandmarks = landmarks.map(lm => ({ x: lm.x, y: lm.y, z: lm.z }));
                return landmarks;
            }
            const SMOOTHER_FACTOR = 0.3;
            const smooth = landmarks.map((lm, i) => {
                const prev = smoothedLandmarks[i] || { x: lm.x, y: lm.y, z: lm.z };
                return {
                    x: prev.x + SMOOTHER_FACTOR * (lm.x - prev.x),
                    y: prev.y + SMOOTHER_FACTOR * (lm.y - prev.y),
                    z: prev.z + SMOOTHER_FACTOR * (lm.z - prev.z)
                };
            });
            smoothedLandmarks = smooth;
            return smooth;
        }

        function distanciaEuclidiana(a, b) {
            return Math.sqrt(
                Math.pow(a.x - b.x, 2) +
                Math.pow(a.y - b.y, 2) +
                Math.pow(a.z - b.z, 2)
            );
        }

        function estaDedoDoblado(tip, mcp, umbral = 0.05) {
            return distanciaEuclidiana(tip, mcp) < umbral;
        }

        function estaDedoExtendido(tip, mcp, umbral = 0.07) {
            return distanciaEuclidiana(tip, mcp) > umbral;
        }

        function detectLSMSign(landmarks) {
            if (!landmarks || landmarks.length !== 21) return null;

            const normalized = normalizeLandmarks(landmarks);
            const smoothed = smoothLandmarks(normalized);

            // Landmark indices for fingers
            const THUMB_TIP = 4, THUMB_MCP = 2;
            const INDEX_TIP = 8, INDEX_MCP = 5;
            const MIDDLE_TIP = 12, MIDDLE_MCP = 9;
            const RING_TIP = 16, RING_MCP = 13;
            const PINKY_TIP = 20, PINKY_MCP = 17;
            const WRIST = 0;

            // Letter A: Fist with thumb on side
            const isThumbAsideA = smoothed[THUMB_TIP].x > smoothed[INDEX_MCP].x + 0.03;
            const isIndexFoldedA = estaDedoDoblado(smoothed[INDEX_TIP], smoothed[INDEX_MCP], 0.06);
            const isMiddleFoldedA = estaDedoDoblado(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP], 0.06);
            const isRingFoldedA = estaDedoDoblado(smoothed[RING_TIP], smoothed[RING_MCP], 0.06);
            const isPinkyFoldedA = estaDedoDoblado(smoothed[PINKY_TIP], smoothed[PINKY_MCP], 0.06);
            if (isThumbAsideA && isIndexFoldedA && isMiddleFoldedA && isRingFoldedA && isPinkyFoldedA) {
                return 'A';
            }

            // Letter B: All fingers extended, thumb folded across palm
            const isThumbFoldedB = distanciaEuclidiana(smoothed[THUMB_TIP], smoothed[PINKY_MCP]) < 0.12;
            const isIndexExtendedB = estaDedoExtendido(smoothed[INDEX_TIP], smoothed[INDEX_MCP], 0.06);
            const isMiddleExtendedB = estaDedoExtendido(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP], 0.06);
            const isRingExtendedB = estaDedoExtendido(smoothed[RING_TIP], smoothed[RING_MCP], 0.06);
            const isPinkyExtendedB = estaDedoExtendido(smoothed[PINKY_TIP], smoothed[PINKY_MCP], 0.06);
            if (isThumbFoldedB && isIndexExtendedB && isMiddleExtendedB && isRingExtendedB && isPinkyExtendedB) {
                return 'B';
            }

            // Letter C: Fingers curved, thumb and fingers forming a C shape
            const thumbIndexDistC = distanciaEuclidiana(smoothed[THUMB_TIP], smoothed[INDEX_TIP]);
            const isCFingerShape = thumbIndexDistC > 0.08 && thumbIndexDistC < 0.22;
            const isMiddleCurvedC = distanciaEuclidiana(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP]) > 0.04 && distanciaEuclidiana(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP]) < 0.12;
            if (isCFingerShape && isMiddleCurvedC) {
                return 'C';
            }

            // Letter D: Index extended, others folded, thumb touches middle
            const isIndexExtendedD = estaDedoExtendido(smoothed[INDEX_TIP], smoothed[INDEX_MCP], 0.06);
            const isMiddleFoldedD = estaDedoDoblado(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP], 0.06);
            const isRingFoldedD = estaDedoDoblado(smoothed[RING_TIP], smoothed[RING_MCP], 0.06);
            const isPinkyFoldedD = estaDedoDoblado(smoothed[PINKY_TIP], smoothed[PINKY_MCP], 0.06);
            const isThumbTouchingMiddleD = distanciaEuclidiana(smoothed[THUMB_TIP], smoothed[MIDDLE_MCP]) < 0.08;
            if (isIndexExtendedD && isMiddleFoldedD && isRingFoldedD && isPinkyFoldedD && isThumbTouchingMiddleD) {
                return 'D';
            }

            // Letter F: Index and thumb form a circle, others extended
            const isThumbIndexCircleF = distanciaEuclidiana(smoothed[THUMB_TIP], smoothed[INDEX_TIP]) < 0.08;
            const isMiddleExtendedF = estaDedoExtendido(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP], 0.06);
            const isRingExtendedF = estaDedoExtendido(smoothed[RING_TIP], smoothed[RING_MCP], 0.06);
            const isPinkyExtendedF = estaDedoExtendido(smoothed[PINKY_TIP], smoothed[PINKY_MCP], 0.06);
            if (isThumbIndexCircleF && isMiddleExtendedF && isRingExtendedF && isPinkyExtendedF) {
                return 'F';
            }

            // Letter G: Index and thumb extended, others folded
            const isIndexExtendedG = estaDedoExtendido(smoothed[INDEX_TIP], smoothed[INDEX_MCP], 0.06);
            const isThumbExtendedG = estaDedoExtendido(smoothed[THUMB_TIP], smoothed[THUMB_MCP], 0.06);
            const isMiddleFoldedG = estaDedoDoblado(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP], 0.06);
            const isRingFoldedG = estaDedoDoblado(smoothed[RING_TIP], smoothed[RING_MCP], 0.06);
            const isPinkyFoldedG = estaDedoDoblado(smoothed[PINKY_TIP], smoothed[PINKY_MCP], 0.06);
            if (isIndexExtendedG && isThumbExtendedG && isMiddleFoldedG && isRingFoldedG && isPinkyFoldedG) {
                return 'G';
            }

            // Letter H: Index and middle extended, others folded
            const isIndexExtendedH = estaDedoExtendido(smoothed[INDEX_TIP], smoothed[INDEX_MCP], 0.06);
            const isMiddleExtendedH = estaDedoExtendido(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP], 0.06);
            const isRingFoldedH = estaDedoDoblado(smoothed[RING_TIP], smoothed[RING_MCP], 0.06);
            const isPinkyFoldedH = estaDedoDoblado(smoothed[PINKY_TIP], smoothed[PINKY_MCP], 0.06);
            const isThumbAsideH = smoothed[THUMB_TIP].x > smoothed[MIDDLE_MCP].x + 0.03;
            if (isIndexExtendedH && isMiddleExtendedH && isRingFoldedH && isPinkyFoldedH && isThumbAsideH) {
                return 'H';
            }

            // Hola: Open hand near face, palm facing inward
            const isHandOpenHola = estaDedoExtendido(smoothed[INDEX_TIP], smoothed[INDEX_MCP], 0.06) &&
                                   estaDedoExtendido(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP], 0.06) &&
                                   estaDedoExtendido(smoothed[RING_TIP], smoothed[RING_MCP], 0.06) &&
                                   estaDedoExtendido(smoothed[PINKY_TIP], smoothed[PINKY_MCP], 0.06);
            const isPalmInwardHola = smoothed[THUMB_TIP].x < smoothed[PINKY_TIP].x; // Palm faces user
            const isNearFaceHola = smoothed[WRIST].y < -0.2; // Hand high in frame (near face)
            if (isHandOpenHola && isPalmInwardHola && isNearFaceHola) {
                return 'saludo_hola';
            }

            // Adiós: Open hand, palm outward, fingers extended
            const isHandOpenAdios = estaDedoExtendido(smoothed[INDEX_TIP], smoothed[INDEX_MCP], 0.06) &&
                                    estaDedoExtendido(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP], 0.06) &&
                                    estaDedoExtendido(smoothed[RING_TIP], smoothed[RING_MCP], 0.06) &&
                                    estaDedoExtendido(smoothed[PINKY_TIP], smoothed[PINKY_MCP], 0.06);
            const isPalmOutwardAdios = smoothed[THUMB_TIP].x > smoothed[PINKY_TIP].x; // Palm faces away
            if (isHandOpenAdios && isPalmOutwardAdios) {
                return 'saludo_adios';
            }

            // Cómo estás: Hand in C shape near chin
            const thumbIndexDistComoEstas = distanciaEuclidiana(smoothed[THUMB_TIP], smoothed[INDEX_TIP]);
            const isCFingerShapeComoEstas = thumbIndexDistC > 0.08 && thumbIndexDistC < 0.22;
            const isMiddleCurvedComoEstas = distanciaEuclidiana(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP]) > 0.04 && distanciaEuclidiana(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP]) < 0.12;
            const isNearChinComoEstas = smoothed[WRIST].y < -0.2 && smoothed[WRIST].y > -0.4; // Near chin level
            if (isCFingerShapeComoEstas && isMiddleCurvedComoEstas && isNearChinComoEstas) {
                return 'saludo_como_estas';
            }

            // Comparte: V shape (index and middle extended), palm down
            const isIndexExtendedComparte = estaDedoExtendido(smoothed[INDEX_TIP], smoothed[INDEX_MCP], 0.06);
            const isMiddleExtendedComparte = estaDedoExtendido(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP], 0.06);
            const isRingFoldedComparte = estaDedoDoblado(smoothed[RING_TIP], smoothed[RING_MCP], 0.06);
            const isPinkyFoldedComparte = estaDedoDoblado(smoothed[PINKY_TIP], smoothed[PINKY_MCP], 0.06);
            const isPalmDownComparte = smoothed[INDEX_TIP].z > smoothed[WRIST].z; // Palm faces down
            if (isIndexExtendedComparte && isMiddleExtendedComparte && isRingFoldedComparte && isPinkyFoldedComparte && isPalmDownComparte) {
                return 'saludo_comparte';
            }

            // Ayuda: A shape, palm up, near chest
            const isThumbAsideAyuda = smoothed[THUMB_TIP].x > smoothed[INDEX_MCP].x + 0.03;
            const isIndexFoldedAyuda = estaDedoDoblado(smoothed[INDEX_TIP], smoothed[INDEX_MCP], 0.06);
            const isMiddleFoldedAyuda = estaDedoDoblado(smoothed[MIDDLE_TIP], smoothed[MIDDLE_MCP], 0.06);
            const isRingFoldedAyuda = estaDedoDoblado(smoothed[RING_TIP], smoothed[RING_MCP], 0.06);
            const isPinkyFoldedAyuda = estaDedoDoblado(smoothed[PINKY_TIP], smoothed[PINKY_MCP], 0.06);
            const isPalmUpAyuda = smoothed[INDEX_TIP].z < smoothed[WRIST].z; // Palm faces up
            const isNearChestAyuda = smoothed[WRIST].y > -0.1 && smoothed[WRIST].y < 0.1; // Chest level
            if (isThumbAsideAyuda && isIndexFoldedAyuda && isMiddleFoldedAyuda && isRingFoldedAyuda && isPinkyFoldedAyuda && isPalmUpAyuda && isNearChestAyuda) {
                return 'saludo_ayuda';
            }

            return null;
        }

        function startCamera() {
            if (cameraInstance) {
                console.log('[DEBUG] Camera already running');
                return;
            }

            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const status = document.getElementById('status');
            const gesture = document.getElementById('gesture');
            const errorMessage = document.getElementById('errorMessage');
            const debugMessage = document.getElementById('debugMessage');
            const videoContainer = document.getElementById('videoContainer');

            if (!video || !canvas || !status || !gesture || !errorMessage || !debugMessage || !videoContainer) {
                console.error('[ERROR] Missing DOM elements for camera');
                errorMessage.textContent = 'Error: Elementos de la interfaz no encontrados.';
                errorMessage.classList.remove('hidden');
                return;
            }

            currentVideo = video;
            const canvasCtx = canvas.getContext('2d');

            handsInstance = new Hands({
                locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1646424915/${file}`
            });

            handsInstance.setOptions({
                maxNumHands: 2,
                modelComplexity: 0,
                minDetectionConfidence: 0.6,
                minTrackingConfidence: 0.6
            });

            handsInstance.onResults(async (results) => {
                const currentTime = performance.now();
                if (currentTime - lastFrameTime < FRAME_INTERVAL) {
                    return;
                }
                lastFrameTime = currentTime;

                canvasCtx.save();
                canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
                canvasCtx.drawImage(video, 0, 0, canvas.width, canvas.height);

                let detectedSign = null;
                let debugInfo = [];

                try {
                    if (results.multiHandLandmarks && results.multiHandedness) {
                        videoContainer.classList.add('hands-detected');
                        status.textContent = 'Manos detectadas';
                        status.classList.remove('blink');

                        for (let i = 0; i < results.multiHandLandmarks.length; i++) {
                            const landmarks = results.multiHandLandmarks[i];
                            const handedness = results.multiHandedness[i];
                            drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, { color: '#34d399', lineWidth: 5 });
                            drawLandmarks(canvasCtx, landmarks, { color: '#a855f7', lineWidth: 2 });

                            let sign = detectLSMSign(landmarks);
                            // Map prefixed signs to user-friendly names
                            if (sign && sign.startsWith('saludo_')) {
                                sign = sign.replace('saludo_', '').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                            }
                            if (sign && !INAPPROPRIATE_SIGNS.includes(sign)) {
                                detectionHistory.push(sign);
                                if (detectionHistory.length > DETECTION_HISTORY_SIZE) {
                                    detectionHistory.shift();
                                }
                                const mostCommonSign = detectionHistory
                                    .sort((a, b) =>
                                        detectionHistory.filter(v => v === a).length -
                                        detectionHistory.filter(v => v === b).length
                                    )
                                    .pop();
                                if (detectionHistory.filter(v => v === mostCommonSign).length >= DETECTION_HISTORY_SIZE * 0.6) {
                                    detectedSign = mostCommonSign;
                                }
                                debugInfo.push(`Mano ${i + 1} (${handedness.label}): ${sign}`);
                            } else {
                                detectionHistory.push(null);
                                if (detectionHistory.length > DETECTION_HISTORY_SIZE) {
                                    detectionHistory.shift();
                                }
                                debugInfo.push(`Mano ${i + 1} (${handedness.label}): No detectada`);
                            }
                        }
                    } else {
                        videoContainer.classList.remove('hands-detected');
                        status.textContent = 'No se detectan manos';
                        status.classList.add('blink');
                        detectionHistory.push(null);
                        if (detectionHistory.length > DETECTION_HISTORY_SIZE) {
                            detectionHistory.shift();
                        }
                        debugInfo.push('No se detectaron manos');
                    }
                } catch (generalError) {
                    console.error('[ERROR] Error general en onResults:', generalError);
                    errorMessage.textContent = 'Error al procesar el frame';
                    errorMessage.classList.remove('hidden');
                }

                canvasCtx.restore();

                if (detectedSign && detectedSign !== lastDetectedSign && sePuedeDetectar) {
                    gesture.textContent = `Seña detectada: ${detectedSign}`;
                    debugMessage.textContent = debugInfo.join('\n');
                    debugMessage.classList.remove('hidden');

                    if (selectedVoice && 'speechSynthesis' in window) {
                        const utterance = new SpeechSynthesisUtterance(detectedSign);
                        utterance.voice = selectedVoice;
                        utterance.lang = selectedVoice ? selectedVoice.lang : 'es-MX';
                        utterance.volume = 1;
                        utterance.rate = 1;
                        utterance.pitch = 1;
                        speechSynthesis.cancel();
                        speechSynthesis.speak(utterance);
                    }
                    lastDetectedSign = detectedSign;
                    ultimaSeña = detectedSign;
                    sePuedeDetectar = false;
                    setTimeout(() => {
                        sePuedeDetectar = true;
                    }, 800);
                } else if (!detectedSign) {
                    gesture.textContent = 'Seña detectada: Ninguna';
                    lastDetectedSign = null;
                    debugMessage.textContent = debugInfo.join('\n');
                    debugMessage.classList.remove('hidden');
                }

                console.log('[DEBUG] Frame processed:\n' + debugInfo.join('\n'));
            });

            navigator.mediaDevices.getUserMedia({
                video: { facingMode: 'user', width: 640, height: 480 }
            }).then(stream => {
                video.srcObject = stream;
                video.play().catch(err => {
                    console.error('[ERROR] Failed to play video:', err);
                    errorMessage.textContent = 'Error al reproducir el video. Verifica los permisos de la cámara.';
                    errorMessage.classList.remove('hidden');
                    status.textContent = 'Error en la cámara';
                    status.classList.add('blink');
                });

                video.onloadedmetadata = () => {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    cameraInstance = new Camera(video, {
                        onFrame: async () => {
                            await handsInstance.send({ image: video });
                        },
                        width: video.videoWidth,
                        height: video.videoHeight
                    });
                    cameraInstance.start();
                    status.textContent = 'Cámara iniciada';
                    console.log('[DEBUG] Camera started with resolution ' + video.videoWidth + 'x' + video.videoHeight);
                };
            }).catch(err => {
                console.error('[ERROR] Camera access denied:', err);
                errorMessage.textContent = 'No se pudo acceder a la cámara. Por favor, permite el acceso.';
                errorMessage.classList.remove('hidden');
                status.textContent = 'Error: Cámara no disponible';
                status.classList.add('blink');
            });
        }

        function stopCamera() {
            if (cameraInstance) {
                cameraInstance.stop();
                cameraInstance = null;
                console.log('[DEBUG] Camera stopped');
            }
            if (currentVideo && currentVideo.srcObject) {
                const stream = currentVideo.srcObject;
                const tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
                currentVideo.srcObject = null;
                console.log('[DEBUG] Video stream stopped');
            }
            if (handsInstance) {
                handsInstance.close();
                handsInstance = null;
                console.log('[DEBUG] Hands instance closed');
            }
            landmarkHistory = [];
            smoothedLandmarks = [];
            detectionHistory = [];
            lastDetectedSign = null;
            sePuedeDetectar = true;
            ultimaSeña = null;
        }

        function clearScreen() {
            app.innerHTML = '';
            stopCamera();
            currentVideo = null;
            console.log('[DEBUG] Screen cleared');
        }

        function renderMainScreen() {
            clearScreen();
            app.innerHTML = `
                <div class="relative min-h-screen flex flex-col items-center justify-center text-white text-center px-4 animate-fade-in">
                    <button class="user-button absolute top-4 right-4" id="userButton">Usuario</button>
                    <img src="assets/img/logo.jpg" alt="Logo" class="header-logo w-24 h-24 md:w-28 md:h-28 mb-6" />
                    <h1 class="text-4xl md:text-5xl font-extrabold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-600 mb-10 drop-shadow-lg">
                        Aprende Lengua de Señas
                    </h1>
                    <div class="flex flex-col md:flex-row gap-6">
                        <button id="btnTraduccion" class="option-button text-xl">
                            🔤 Traducción
                        </button>
                        <button id="btnAprendizaje" class="option-button text-xl">
                            📚 Aprendizaje
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('btnTraduccion').addEventListener('click', renderTraduccionScreen);
            document.getElementById('btnAprendizaje').addEventListener('click', renderAprendizajeScreen);
            document.getElementById('userButton').addEventListener('click', renderUserScreen);
            console.log('[DEBUG] Main screen rendered');
        }

        function renderUserScreen() {
            const userName = localStorage.getItem('userName') || 'Usuario Ejemplo';
            const profilePicture = localStorage.getItem('profilePicture') || 'https://via.placeholder.com/100?text=User';
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <img src="${profilePicture}" alt="User Profile" id="profilePicture" />
                    <input type="text" id="userNameInput" value="${userName}" placeholder="Ingresa tu nombre" />
                    <input type="file" id="profilePictureInput" accept="image/*" />
                    <button class="back-button mt-4" id="saveUserProfile">Guardar</button>
                    <button class="back-button mt-2" id="closeUserModal">Cerrar</button>
                </div>
            `;
            document.body.appendChild(modal);

            const userNameInput = document.getElementById('userNameInput');
            const profilePictureInput = document.getElementById('profilePictureInput');
            const profilePictureImg = document.getElementById('profilePicture');

            profilePictureInput.addEventListener('change', () => {
                const file = profilePictureInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        profilePictureImg.src = e.target.result;
                        localStorage.setItem('profilePicture', e.target.result);
                        console.log('[DEBUG] Profile picture updated');
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.getElementById('saveUserProfile').addEventListener('click', () => {
                const newName = userNameInput.value.trim();
                if (newName) {
                    localStorage.setItem('userName', newName);
                    console.log('[DEBUG] User name saved: ' + newName);
                }
            });

            document.getElementById('closeUserModal').addEventListener('click', () => {
                modal.remove();
                console.log('[DEBUG] User modal closed');
            });

            console.log('[DEBUG] User screen rendered');
        }

        function renderTraduccionScreen() {
            clearScreen();
            app.innerHTML = `
                <div class="relative min-h-screen flex flex-col items-center justify-center">
                    <button class="user-button absolute top-4 right-4" id="userButton">Usuario</button>
                    <button class="back-button absolute top-4 left-4" id="backToMenu">← Volver</button>
                    <h2 class="text-3xl font-semibold text-center mb-6">Traducción en Tiempo Real</h2>
                    <div id="videoContainer" class="video-container">
                        <video id="video" autoplay playsinline></video>
                        <canvas id="canvas"></canvas>
                    </div>
                    <div class="text-center mt-6">
                        <label for="voiceSelect" class="text-lg">Seleccionar voz:</label>
                        <select id="voiceSelect" class="combobox mt-2">
                            <option value="" disabled selected>Elige una voz</option>
                        </select>
                        <p id="status" class="status-text mt-4">Iniciando cámara...</p>
                        <p id="gesture" class="status-text mt-2">Seña detectada: Ninguna</p>
                        <div id="errorMessage" class="error-message hidden mt-4"></div>
                        <div id="debugMessage" class="debug-text hidden mt-4"></div>
                    </div>
                </div>
            `;
            document.getElementById('backToMenu').addEventListener('click', renderMainScreen);
            document.getElementById('userButton').addEventListener('click', renderUserScreen);
            populateVoiceSelect();
            startCamera();
            console.log('[DEBUG] Traducción screen rendered');
        }

        function populateVoiceSelect() {
            const voiceSelect = document.getElementById('voiceSelect');
            if (!voiceSelect) return;

            const updateVoices = () => {
                const voices = speechSynthesis.getVoices();
                voiceSelect.innerHTML = '<option value="" disabled selected>Elige una voz</option>';
                if (voices.length === 0) {
                    voiceSelect.innerHTML += '<option value="" disabled>No hay voces disponibles</option>';
                    console.warn('[DEBUG] No voices available');
                    return;
                }
                const spanishVoices = voices.filter(v => v.lang.startsWith('es-'));
                const otherVoices = voices.filter(v => !v.lang.startsWith('es-'));
                [...spanishVoices, ...otherVoices].forEach((voice, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = `${voice.name} (${voice.lang})`;
                    voiceSelect.appendChild(option);
                });
                if (spanishVoices.length > 0) {
                    selectedVoice = spanishVoices[0];
                    voiceSelect.value = voices.indexOf(spanishVoices[0]);
                } else if (voices.length > 0) {
                    selectedVoice = voices[0];
                    voiceSelect.value = 0;
                }
            };

            if (speechSynthesis.getVoices().length > 0) {
                updateVoices();
            } else {
                speechSynthesis.onvoiceschanged = updateVoices;
            }

            voiceSelect.addEventListener('change', () => {
                const voices = speechSynthesis.getVoices();
                selectedVoice = voices[voiceSelect.value] || null;
                console.log(`[DEBUG] Voice selected: ${selectedVoice ? selectedVoice.name : 'None'}`);
            });
        }

        function renderAprendizajeScreen() {
            clearScreen();
            app.innerHTML = `
                <div class="relative min-h-screen flex flex-col items-center justify-center">
                    <button class="user-button absolute top-4 right-4" id="userButton">Usuario</button>
                    <button class="back-button absolute top-4 left-4" id="backToMenu2">← Volver</button>
                    <h2 class="text-3xl font-semibold text-center mb-6">Módulo de Aprendizaje</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <button id="videoButton" class="card p-6 text-center">Vídeos</button>
                        <button id="imageButton" class="card p-6 text-center">Imágenes</button>
                    </div>
                    <div id="contentContainer" class="mt-6"></div>
                </div>
            `;
            document.getElementById('backToMenu2').addEventListener('click', renderMainScreen);
            document.getElementById('userButton').addEventListener('click', renderUserScreen);
            document.getElementById('videoButton').addEventListener('click', () => showCategories('videos'));
            document.getElementById('imageButton').addEventListener('click', () => showCategories('images'));
            console.log('[DEBUG] Aprendizaje screen rendered');
        }

        function showCategories(type) {
            const contentContainer = document.getElementById('contentContainer');
            contentContainer.innerHTML = `<div class="debug-text">Cargando categorías de ${type}...</div>`;

            const subfolders = [
                'abecedario', 'animales', 'casa', 'colores', 'comida', 'cuerpo', 'diasdesemana',
                'escuela', 'estaciones', 'meses', 'tiempo', 'saludos', 'groserias'
            ];
            contentContainer.innerHTML = `
                <h3 class="text-2xl font-semibold mb-4">Categorías de ${type.charAt(0).toUpperCase() + type.slice(1)}</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    ${subfolders.map(folder => `
                        <button class="category-button card p-3 text-center" data-type="${type}" data-folder="${folder}">
                            ${folder.charAt(0).toUpperCase() + folder.slice(1)}
                        </button>
                    `).join('')}
                </div>
            `;

            document.querySelectorAll('.category-button').forEach(button => {
                button.addEventListener('click', () => {
                    const type = button.dataset.type;
                    const folder = button.dataset.folder;
                    if (type === 'videos') showVideos(folder);
                    else showImages(folder);
                });
            });
            console.log('[DEBUG] Categories loaded: ' + type);
        }

        function showVideos(folder) {
            const contentContainer = document.getElementById('contentContainer');
            const videoFiles = [
                { name: 'Video 1', path: `/LENGUAJE-DE-SENAS/assets/videos/${folder}/Video1.mp4` },
                { name: 'Video 2', path: `/LENGUAJE-DE-SENAS/${folder}/${folder}/videos/Video2.mp4` },
                { name: 'Video 3', path: `/Videos/${folder}/Video3.mp4` },
                { name: 'Videos 4', path: '/LENGUAJE-DE-SENAS/**/${folder}/Video4.mp4' }
            ];

            contentContainer.innerHTML = `
                <h3 class="text-2xl font-semibold mb-4">${folder.charAt(0).toUpperCase() + folder.slice(1)}</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    ${videoFiles.map(video => `
                        <div class="card p-4 text-center">
                            <video controls preload="metadata" class="w-full max-w-md rounded-lg">
                                <source src="${video.path}" type="video/mp4">
                                Tu navegador no soporta el elemento de video.
                            </video>
                            <p class="mt-2">Vídeo: ${video.name} - ${folder}</p>
                        </div>
                    `).join('')}
                </div>
            `;

            contentContainer.querySelectorAll('video').forEach(video => {
                video.onloadeddata = () => console.log('[DEBUG] Video loaded: ' + video.querySelector('source').src);
                video.onerror = () => {
                    console.error('[ERROR] Video failed to load: ' + video.querySelector('source').src);
                    video.parentElement.innerHTML += '<div class="error-message">No se pudo cargar el video.</div>';
                };
            });

            console.log('[DEBUG] Videos loaded for: ' + folder);
        }

        function showImages(folder) {
            const contentContainer = document.getElementById('contentContainer');
            contentContainer.innerHTML = '<div class="debug-text">Cargando imágenes...</div>';
            const images = fetchImages(folder);
            contentContainer.innerHTML = `
                <h3 class="text-2xl font-semibold mb-4">${folder.charAt(0).toUpperCase() + folder.slice(1)}</h3>
                ${images.length === 0 ? '<div class="error-message">No hay imágenes en esta categoría.</div>' : `
                    <div class="carousel-container">
                        <div class="carousel" id="carousel">
                            ${images.map(img => `
                                <div class="carousel-item">
                                    <img src="${img.path}" alt="${img.name}">
                                    <p class="mt-2">${img.name}</p>
                                </div>
                            `).join('')}
                        </div>
                        <button class="carousel-nav prev" onclick="moveCarousel(-1)">←</button>
                        <button class="carousel-nav next" onclick="moveCarousel(1)">→</button>
                    </div>
                `}
            `;
            contentContainer.querySelectorAll('img').forEach(img => {
                img.onload = () => console.log('[DEBUG] Image loaded: ' + img.src);
                img.onerror = () => {
                    console.error('[ERROR] Image failed to load: ' + img.src);
                    img.parentElement.innerHTML += '<div class="error-message">No se pudo cargar la imagen.</div>';
                };
            });
            initializeCarousel();
            console.log('[DEBUG] Images loaded for: ' + folder);
        }

        function fetchImages(folder) {
            const basePath = `assets/img/${folder}/`;
            const images = {
                abecedario: [
                    { name: 'Letra A', path: `${basePath}letra_A.jpg` },
                    { name: 'Letra B', path: `${basePath}letra_B.jpg` },
                    { name: 'Letra C', path: `${basePath}letra_C.jpg` },
                    { name: 'Letra D', path: `${basePath}letra_D.jpg` },
                    { name: 'Letra E', path: `${basePath}letra_E.jpg` },
                    { name: 'Letra F', path: `${basePath}letra_F.jpg` },
                    { name: 'Letra G', path: `${basePath}letra_G.jpg` },
                    { name: 'Letra H', path: `${basePath}letra_H.jpg` },
                    { name: 'Letra I', path: `${basePath}letra_I.jpg` },
                    { name: 'Letra J', path: `${basePath}letra_J.jpg` },
                    { name: 'Letra K', path: `${basePath}letra_K.jpg` },
                    { name: 'Letra L', path: `${basePath}letra_L.jpg` },
                    { name: 'Letra M', path: `${basePath}letra_M.jpg` },
                    { name: 'Letra N', path: `${basePath}letra_N.jpg` },
                    { name: 'Letra O', path: `${basePath}letra_O.jpg` },
                    { name: 'Letra P', path: `${basePath}letra_P.jpg` },
                    { name: 'Letra Q', path: `${basePath}letra_Q.jpg` },
                    { name: 'Letra R', path: `${basePath}letra_R.jpg` },
                    { name: 'Letra S', path: `${basePath}letra_S.jpg` },
                    { name: 'Letra T', path: `${basePath}letra_T.jpg` },
                    { name: 'Letra U', path: `${basePath}letra_U.jpg` },
                    { name: 'Letra V', path: `${basePath}letra_V.jpg` },
                    { name: 'Letra W', path: `${basePath}letra_W.jpg` },
                    { name: 'Letra X', path: `${basePath}letra_X.jpg` },
                    { name: 'Letra Y', path: `${basePath}letra_Y.jpg` },
                    { name: 'Letra Z', path: `${basePath}letra_Z.jpg` }
                ],
                animales: [
                    { name: 'Vaca', path: `${basePath}vaca.jpg` },
                    { name: 'Lobo', path: `${basePath}lobo.jpg` },
                    { name: 'Jirafa', path: `${basePath}jirafa.jpg` },
                    { name: 'Tiburón', path: `${basePath}tiburon.jpg` },
                    { name: 'Perro', path: `${basePath}perro.jpg` },
                    { name: 'Gato', path: `${basePath}gato.jpg` },
                    { name: 'Puerco', path: `${basePath}puerco.jpg` },
                    { name: 'Rinoceronte', path: `${basePath}rinoceronte.jpg` },
                    { name: 'Serpiente', path: `${basePath}serpiente.jpg` },
                    { name: 'Tigre', path: `${basePath}tigre.jpg` },
                    { name: 'Toro', path: `${basePath}toro.jpg` },
                    { name: 'Libélula', path: `${basePath}libelula.jpg` },
                    { name: 'Lagarto', path: `${basePath}lagarto.jpg` },
                    { name: 'Gorila', path: `${basePath}gorila.jpg` },
                    { name: 'Foca', path: `${basePath}foca.jpg` }
                ],
                casa: [
                    { name: 'Almohada', path: `${basePath}almohada.jpg` },
                    { name: 'Azotea', path: `${basePath}azotea.jpg` },
                    { name: 'Azúcarera', path: `${basePath}azucarera.jpg` },
                    { name: 'Baño', path: `${basePath}baño.jpg` },
                    { name: 'Barrer', path: `${basePath}barrer.jpg` },
                    { name: 'Batidora', path: `${basePath}batidora.jpg` },
                    { name: 'Bote', path: `${basePath}bote.jpg` },
                    { name: 'Buzón', path: `${basePath}buzon.jpg` },
                    { name: 'Cacerola', path: `${basePath}cacerola.jpg` },
                    { name: 'Cajón', path: `${basePath}cajon.jpg` },
                    { name: 'Cama', path: `${basePath}cama.jpg` },
                    { name: 'Candelero', path: `${basePath}candelero.jpg` },
                    { name: 'Casa', path: `${basePath}casa.jpg` },
                    { name: 'Cazuela', path: `${basePath}cazuela.jpg` },
                    { name: 'Cepillo de dientes', path: `${basePath}cepillo_dientes.jpg` },
                    { name: 'Cepillo de pelo', path: `${basePath}cepillo_pelo.jpg` },
                    { name: 'Champú', path: `${basePath}champu.jpg` },
                    { name: 'Charola', path: `${basePath}charola.jpg` },
                    { name: 'Chupón', path: `${basePath}chupon.jpg` },
                    { name: 'Cobertor', path: `${basePath}cobertor.jpg` },
                    { name: 'Coladera', path: `${basePath}coladera.jpg` },
                    { name: 'Colcha', path: `${basePath}colcha.jpg` },
                    { name: 'Colador', path: `${basePath}colador.jpg` },
                    { name: 'Comal', path: `${basePath}comal.jpg` },
                    { name: 'Comedor', path: `${basePath}comedor.jpg` },
                    { name: 'Cómoda', path: `${basePath}comoda.jpg` },
                    { name: 'Condominio', path: `${basePath}condominio.jpg` },
                    { name: 'Copa', path: `${basePath}copa.jpg` },
                    { name: 'Corredor', path: `${basePath}corredor.jpg` },
                    { name: 'Corriente', path: `${basePath}corriente.jpg` },
                    { name: 'Cortina', path: `${basePath}cortina.jpg` },
                    { name: 'Cuarto', path: `${basePath}cuarto.jpg` },
                    { name: 'Cuchara', path: `${basePath}cuchara.jpg` },
                    { name: 'Cuchillo', path: `${basePath}cuchillo.jpg` },
                    { name: 'Departamento', path: `${basePath}departamento.jpg` },
                    { name: 'Destapador', path: `${basePath}destapador.jpg` }
                ],
                colores: [
                    { name: 'Naranja', path: `${basePath}naranja.jpg` },
                    { name: 'Rojo', path: `${basePath}rojo.jpg` },
                    { name: 'Verde', path: `${basePath}verde.jpg` },
                    { name: 'Rosa', path: `${basePath}rosa.jpg` },
                    { name: 'Blanco', path: `${basePath}blanco.jpg` },
                    { name: 'Negro', path: `${basePath}negro.jpg` },
                    { name: 'Café', path: `${basePath}cafe.jpg` }
                ],
                comida: [
                    { name: 'Comida 1', path: `${basePath}comida_1.jpg` },
                    { name: 'Comida 2', path: `${basePath}comida_2.jpg` },
                ],
                cuerpo: [
                    { name: 'Mano', path: `${basePath}cuerpo_mano.jpg` },
                    { name: 'Pie', path: `${basePath}cuerpo_pie.jpg` },
                    { name: 'Cabeza', path: `${basePath}cuerpo_cabeza.jpg` },
                    { name: 'Brazo', path: `${basePath}cuerpo_brazo.jpg` },
                    { name: 'Pierna', path: `${basePath}cuerpo_pierna.jpg` }
                ],
                diasdesemana: [
                    { name: 'Lunes', path: `${basePath}lunes.jpg` },
                    { name: 'Martes', path: `${basePath}martes.jpg` },
                    { name: 'Miércoles', path: `${basePath}miercoles.jpg` },
                    { name: 'Jueves', path: `${basePath}jueves.jpg` },
                    { name: 'Viernes', path: `${basePath}viernes.jpg` },
                    { name: 'Sábado', path: `${basePath}sabado.jpg` },
                    { name: 'Domingo', path: `${basePath}domingo.jpg` }
                ],
                escuela: [
                    { name: 'Antropología', path: `${basePath}antropologia.jpg` },
                    { name: 'Bandera', path: `${basePath}bandera.jpg` },
                    { name: 'Calificación', path: `${basePath}calificacion.jpg` },
                    { name: 'Campana', path: `${basePath}campana.jpg` },
                    { name: 'Certificado', path: `${basePath}certificado.jpg` },
                    { name: 'Compás', path: `${basePath}compas.jpg` },
                    { name: 'Computación', path: `${basePath}computacion.jpg` },
                    { name: 'Cuaderno', path: `${basePath}cuaderno.jpg` },
                    { name: 'Dibujo', path: `${basePath}dibujo.jpg` },
                    { name: 'Diccionario', path: `${basePath}diccionario.jpg` },
                    { name: 'Escala', path: `${basePath}escala.jpg` },
                    { name: 'Escuadra', path: `${basePath}escuadra.jpg` },
                    { name: 'Escuela', path: `${basePath}escuela.jpg` },
                    { name: 'Estudiante', path: `${basePath}estudiante.jpg` },
                    { name: 'Goma', path: `${basePath}goma.jpg` },
                    { name: 'Lápiz', path: `${basePath}lapiz.jpg` },
                    { name: 'Lección', path: `${basePath}leccion.jpg` },
                    { name: 'Mapa', path: `${basePath}mapa.jpg` },
                    { name: 'Microscopio', path: `${basePath}microscopio.jpg` },
                    { name: 'Papel', path: `${basePath}papel.jpg` },
                    { name: 'Párrafo', path: `${basePath}parrafo.jpg` },
                    { name: 'Perspectiva', path: `${basePath}perspectiva.jpg` },
                    { name: 'Pizarrón', path: `${basePath}pizarron.jpg` },
                    { name: 'Pluma', path: `${basePath}pluma.jpg` },
                    { name: 'Politécnico', path: `${basePath}politecnico.jpg` },
                    { name: 'Premio', path: `${basePath}premio.jpg` },
                    { name: 'Preparatoria', path: `${basePath}preparatoria.jpg` },
                    { name: 'Primaria', path: `${basePath}primaria.jpg` },
                    { name: 'Prueba', path: `${basePath}prueba.jpg` },
                    { name: 'Química', path: `${basePath}quimica.jpg` },
                    { name: 'Sacapuntas', path: `${basePath}sacapuntas.jpg` },
                    { name: 'Secundaria', path: `${basePath}secundaria.jpg` },
                    { name: 'Tecnológico', path: `${basePath}tecnologico.jpg` }
                ],
                estaciones: [
                    { name: 'Primavera', path: `${basePath}primavera.jpg` },
                    { name: 'Verano', path: `${basePath}verano.jpg` },
                    { name: 'Otoño', path: `${basePath}otoño.jpg` },
                    { name: 'Invierno', path: `${basePath}invierno.jpg` }
                ],
                meses: [
                    { name: 'Enero', path: `${basePath}enero.jpg` },
                    { name: 'Febrero', path: `${basePath}febrero.jpg` },
                    { name: 'Marzo', path: `${basePath}marzo.jpg` },
                    { name: 'Abril', path: `${basePath}abril.jpg` },
                    { name: 'Mayo', path: `${basePath}mayo.jpg` },
                    { name: 'Junio', path: `${basePath}junio.jpg` },
                    { name: 'Julio', path: `${basePath}julio.jpg` },
                    { name: 'Agosto', path: `${basePath}agosto.jpg` },
                    { name: 'Septiembre', path: `${basePath}septiembre.jpg` },
                    { name: 'Octubre', path: `${basePath}octubre.jpg` },
                    { name: 'Noviembre', path: `${basePath}noviembre.jpg` },
                    { name: 'Diciembre', path: `${basePath}diciembre.jpg` }
                ],
                tiempo: [
                    { name: 'Sol', path: `${basePath}tiempo_sol.jpg` },
                    { name: 'Lluvia', path: `${basePath}tiempo_lluvia.jpg` },
                    { name: 'Nieve', path: `${basePath}tiempo_nieve.jpg` },
                    { name: 'Viento', path: `${basePath}tiempo_viento.jpg` }
                ],
                saludos: [
                    { name: 'Hola', path: `${basePath}saludo_hola.jpg` },
                    { name: 'Adiós', path: `${basePath}saludo_adios.jpg` },
                    { name: 'Cómo estás', path: `${basePath}saludo_como_estas.jpg` },
                    { name: 'Comparte', path: `${basePath}saludo_comparte.jpg` },
                    { name: 'Ayuda', path: `${basePath}saludo_ayuda.jpg` }
                ],
                groserias: [
                    { name: 'Tonto', path: `${basePath}groseria_tonto.jpg` },
                    { name: 'Güey', path: `${basePath}groseria_guey.jpg` },
                    { name: 'Idiota', path: `${basePath}groseria_idiota.jpg` },
                    { name: 'Puto', path: `${basePath}groseria_puto.jpg` },
                    { name: 'Mierda', path: `${basePath}groseria_mierda.jpg` },
                    { name: 'Zorra', path: `${basePath}groseria_zorra.jpg` },
                    { name: 'Pendejo', path: `${basePath}groseria_pendejo.jpg` },
                    { name: 'Verga', path: `${basePath}groseria_verga.jpg` }
                ]
            };
            return images[folder] || [];
        }

        let currentIndex = 0;
        function initializeCarousel() {
            const carousel = document.getElementById('carousel');
            if (!carousel) return;
            const items = carousel.children.length;
            if (items === 0) return;
            currentIndex = 0;
            carousel.style.transform = `translateX(0%)`;
        }

        function moveCarousel(direction) {
            const carousel = document.getElementById('carousel');
            if (!carousel) return;
            const items = carousel.children.length;
            if (items === 0) return;
            currentIndex = (currentIndex + direction + items) % items;
            carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
            console.log('[DEBUG] Carousel moved: index=' + currentIndex);
        }

        window.moveCarousel = moveCarousel;

        renderMainScreen();

        console.log('[DEBUG] Application initialized');
    </script>
</body>
</html>